name: srv6lab
topology:
  nodes:
    PE1:
      kind: linux
      image: frr-srv6
      network-mode: none
      binds:
        - pe1.conf:/etc/frr/frr.conf
      exec:
        - ip link add VRF1 type vrf table 10
        - ip link set VRF1 up
        - ip link add sr0 type dummy
        - ip link set sr0 master VRF1
        - ip link set sr0 up
        - ip link set ens5 master VRF1
        - ip link set ens5 up
        - ip link set ens4 up
        - sysctl -w net.vrf.strict_mode=1
    PE2:
      kind: linux
      image: frr-srv6
      network-mode: none
      binds:
        - pe2.conf:/etc/frr/frr.conf
      exec:
        - ip link add VRF1 type vrf table 10
        - ip link set VRF1 up
        - ip link add sr0 type dummy
        - ip link set sr0 master VRF1
        - ip link set sr0 up
        - ip link set ens5 master VRF1
        - ip link set ens5 up
        - ip link set ens4 up
        - sysctl -w net.vrf.strict_mode=1
    CE1:
      kind: linux
      image: praqma/network-multitool:latest
      network-mode: none
      exec:
        - ip addr add 10.0.10.2/24 dev eth1
        - ip addr add 2001:db8:a::2/64 dev eth1
        - ip link set eth1 up
        - ip route add default via 10.0.10.1
        - ip -6 route add default via 2001:db8:a::1
    CE2:
      kind: linux
      image: praqma/network-multitool:latest
      network-mode: none
      exec:
        - ip addr add 10.0.11.2/24 dev eth1
        - ip addr add 2001:db8:b::2/64 dev eth1
        - ip link set eth1 up
        - ip route add default via 10.0.11.1
        - ip -6 route add default via 2001:db8:b::1
  links:
    - endpoints: ["PE1:ens4", "PE2:ens4"]
    - endpoints: ["PE1:ens5", "CE1:eth1"]
    - endpoints: ["PE2:ens5", "CE2:eth1"]

