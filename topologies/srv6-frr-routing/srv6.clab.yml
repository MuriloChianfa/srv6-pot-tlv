name: srv6

topology:
  defaults:
    kind: linux
    image: frr-srv6
    network-mode: none
  nodes:
    frr1:
      binds:
        - frr1.conf:/etc/frr/frr.conf
    frr2:
      binds:
        - frr2.conf:/etc/frr/frr.conf
    frr3:
      binds:
        - frr3.conf:/etc/frr/frr.conf
      exec:
        - ip link add Client1 type vrf table 10
        - ip link set Client1 up
        - ip link add sr0 type dummy
        - ip link set sr0 master Client1
        - ip link set sr0 up
        - ip link set eth4 master Client1
        - ip link set eth4 up
        - ip link add Client2 type vrf table 20
        - ip link set Client2 up
        - ip link set sr0 master Client2
        - ip link set sr0 up
        - ip link set eth5 master Client2
        - ip link set eth5 up
    frr4:
      binds:
        - frr4.conf:/etc/frr/frr.conf
    frr5:
      binds:
        - frr5.conf:/etc/frr/frr.conf
    frr6:
      binds:
        - frr6.conf:/etc/frr/frr.conf
      exec:
        - ip link add Client1 type vrf table 10
        - ip link set Client1 up
        - ip link add sr0 type dummy
        - ip link set sr0 master Client1
        - ip link set sr0 up
        - ip link set eth4 master Client1
        - ip link set eth4 up
        - ip link add Client2 type vrf table 20
        - ip link set Client2 up
        - ip link set sr0 master Client2
        - ip link set sr0 up
        - ip link set eth5 master Client2
        - ip link set eth5 up
    c1r1:
      binds:
        - c1r1.conf:/etc/frr/frr.conf
    c1r2:
      binds:
        - c1r2.conf:/etc/frr/frr.conf
    c2r1:
      binds:
        - c2r1.conf:/etc/frr/frr.conf
    c2r2:
      binds:
        - c2r2.conf:/etc/frr/frr.conf
    host11:
      image: praqma/network-multitool:latest
    host12:
      image: praqma/network-multitool:latest
    host21:
      image: praqma/network-multitool:latest
    host22:
      image: praqma/network-multitool:latest

  links:
    - endpoints: ["frr1:eth1", "frr3:eth1"]
    - endpoints: ["frr1:eth2", "frr2:eth2"]
    - endpoints: ["frr1:eth3", "frr5:eth3"]
    - endpoints: ["frr2:eth1", "frr6:eth1"]
    - endpoints: ["frr3:eth2", "frr4:eth2"]
    - endpoints: ["frr3:eth4", "c1r1:eth1"]
    - endpoints: ["frr3:eth5", "c2r1:eth1"]
    - endpoints: ["frr4:eth1", "frr5:eth1"]
    - endpoints: ["frr5:eth2", "frr6:eth2"]
    - endpoints: ["frr6:eth4", "c1r2:eth1"]
    - endpoints: ["frr6:eth5", "c2r2:eth1"]
    - endpoints: ["host11:eth1", "c1r1:eth2"]
    - endpoints: ["host12:eth1", "c1r2:eth2"]
    - endpoints: ["host21:eth1", "c2r1:eth2"]
    - endpoints: ["host22:eth1", "c2r2:eth2"]
